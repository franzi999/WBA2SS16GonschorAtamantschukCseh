<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title> Mitfahrgelegenheit</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
    $(function(){
      $("#sub").click(function(event) {
        alert('buchen');
        //Abschicken und Seite neu laden unterbinden
        event.preventDefault();
        neuP = <%= fahrt.plaetze%>;
        alert(neuP);
        neuP -= 1;
        alert(neuP);
        var newFahrt = {
        start: '<%= fahrt.start%>',
        ziel: '<%= fahrt.ziel%>',
        plaetze: neuP,
        u_id: '<%= fahrt.u_id%>'
        };
        $.ajax({
          type: 'PUT',
          host: 'localhost',
          url: '/fahrt/' + <%= fahrt.id %> ,
          contentType: 'application/json',
          data: JSON.stringify(newFahrt),
          success: function(newFahrt){
            console.log(JSON.stringify(newFahrt));
            window.location = "http://localhost:3001/search";
          }
        });
        alert("fahrt löschen?")
        if (neuP == 0){
          alert("fahrt wird gelöscht")
          $.ajax({
            type: 'DELETE',
            host: 'localhost',
            url: '/fahrt/' + <%= fahrt.id %> ,
            contentType: 'application/json',
            success: function(){
              alert('fahrt geloescht');
            }
          });
        }
        });
      });
    </script>
</head>
<header>
    <ul id="head">
        <li class="he"><a href="http://localhost:3001">Home</a></li>
        <li class="he"><a href="http://localhost:3001/search">Fahrten</a></li>
        <li class="he"><a href="http://localhost:3001/newuser">Fahrt erstellen</a></li>
        <li class="he"><a href="http://localhost:3001/usverwaltung">User</a></li>
        <li class="he"><a href="about.asp">About</a></li>
    </ul>
</header>
<body>
    <div id="mid">
        <div id="fdata">
              <ul class="list">
                <p> Augewaehlte Fahrt</p>
                <hr>
                  <li>Start: <%= fahrt.start%> </li><br>
                  <li>Ziel: <%= fahrt.ziel %> </li><br>
                  <li>Plaetze: <%= fahrt.plaetze %> </li><br>
              </ul>
            <ul id="lid">
              <p>Kontaktdaten des Anbieters</p>
              <hr>
              <% users.forEach(function(users) { %>
                <li>Name: <%= users.nachname%> </li><br>
                <li>Vorname: <%= users.vorname %> </li><br>
                <li>Email: <%= users.email %> </li><br>
                <li>Telefon: <%= users.tel %> </li><br>
                <li>Handy: <%= users.mobil %> </li><br>
                <li>Fahrzeug: <%= users.car %> </li><br>
                <% }); %>
            </ul>
            <form id="buch">
                <label class="ser" for="mail">Ihre Email</label><br>
                <input type="text" id="mail" name="mail">
                <input type="submit" id="sub" name="ko" value="buchen">
            </form>
        </div>
    </div>
<footer>
    Copyright Igelex
</footer>
</body>

</html>
